library(readr)
library(xlsx)
library(dplyr)
library(purrr)
library(tidyverse)
library(openxlsx)
library(readxl)
library(janitor)

# STORE THE PATH TO THE FILES IN AN OBJECT
path.a <- "C:\\Users\\ikechukwuka.abah\\OneDrive - Palladium International, LLC\\Documents\\Public Health Surveillance and HREC Support\\FY 25\\Data Downloads\\EMR\\RADET\\ACE5_ACE6_KPC1_KPC2_COMBINED RADET 03-01-2025.xlsx"
path.b <- "C:\\Users\\ikechukwuka.abah\\OneDrive - Palladium International, LLC\\Documents\\Public Health Surveillance and HREC Support\\FY 25\\Data Downloads\\EMR\\RADET\\ACE1_ACE2_ACE3_ACE4_COMBINED RADET_03-01-2025.xlsx"

# READ THE RADET FILES IN R AND SELECT THE RELEVANT COLUMNS
RADET.a <- read.xlsx(path.a) %>%
  dplyr::select(IP,
                State,
                L.G.A,
                `LGA.Of.Residence`,
                Facility.Name,
                DatimId,
                Patient.ID,
                NDR.Patient.Identifier,
                Hospital.Number,
                Sex,
                Target.group,
                `Current.Weight.(kg)`,
                Pregnancy.Status,
                `Date.of.Birth.(yyyy-mm-dd)`,
                Care.Entry.Point,
                Date.of.Registration,
                `Enrollment.Date.(yyyy-mm-dd)`,
                `ART.Start.Date.(yyyy-mm-dd)`,
                `Last.Pickup.Date.(yyyy-mm-dd)`,
                Months.of.ARV.Refill,
                Regimen.Line.at.ART.Start,
                Regimen.at.ART.Start,
                Date.of.Start.of.Current.ART.Regimen,
                Current.Regimen.Line,
                Current.ART.Regimen,
                Clinical.Staging.at.Last.Visit,
                Date.of.Last.CD4.Count,
                Last.CD4.Count,
                `Date.of.Viral.Load.Sample.Collection.(yyyy-mm-dd)`,
                `Date.of.Current.ViralLoad.Result.Sample.(yyyy-mm-dd)`,
                `Current.Viral.Load.(c/ml)`,
                `Date.of.Current.Viral.Load.(yyyy-mm-dd)`,
                Viral.Load.Indication,
                Current.ART.Status,
                Date.of.Current.ART.Status,
                Client.Verification.Outcome,
                Cause.of.Death,
                VA.Cause.of.Death,
                Previous.ART.Status,
                Confirmed.Date.of.Previous.ART.Status,
                ART.Enrollment.Setting,
                `Date.of.TB.Screening.(yyyy-mm-dd)`,
                TB.Screening.Type,
                TB.status,
                `Date.of.TB.Sample.Collection.(yyyy-mm-dd)`,
                TB.Diagnostic.Test.Type,
                `Date.of.TB.Diagnostic.Result.Received.(yyyy-mm-dd)`,
                TB.Diagnostic.Result,
                `Date.of.Start.of.TB.Treatment.(yyyy-mm-dd)`,
                `TB.Type.(new,.relapsed.etc)`,
                `Date.of.Completion.of.TB.Treatment.(yyyy-mm-dd)`,
                TB.Treatment.Outcome,
                `Date.of.TPT.Start.(yyyy-mm-dd)`,
                TPT.Type,
                `TPT.Completion.date.(yyyy-mm-dd)`,
                TPT.Completion.status,
                `Date.of.commencement.of.EAC.(yyyy-mm-dd)`,
                Number.of.EAC.Sessions.Completed,
                Date.of.last.EAC.Session.Completed,
                `Date.of.Extended.EAC.Completion.(yyyy-mm-dd)`,
                `Date.of.Repeat.Viral.Load.-.Post.EAC.VL.Sample.collected.(yyyy-mm-dd)`,
                `Repeat.Viral.load.result.(c/ml)-.POST.EAC`,
                `Date.of.Repeat.Viral.load.result-.POST.EAC.VL`,
                Date.of.devolvement,
                Model.devolved.to,
                Date.of.current.DSD,
                Current.DSD.model,
                `Date.of.Return.of.DSD.Client.to.Facility.(yyyy-mm-dd)`,
                Screening.for.Chronic.Conditions,
                `Co-morbidities`,
                `Date.of.Cervical.Cancer.Screening.(yyyy-mm-dd)`,
                Cervical.Cancer.Screening.Type,
                Cervical.Cancer.Screening.Method,
                Result.of.Cervical.Cancer.Screening,
                `Date.of.Precancerous.Lesions.Treatment.(yyyy-mm-dd)`,
                Precancerous.Lesions.Treatment.Methods
                )

RADET.b <- read.xlsx(path.b) %>%
  dplyr::select(IP,
                State,
                L.G.A,
                `LGA.Of.Residence`,
                Facility.Name,
                DatimId,
                Patient.ID,
                NDR.Patient.Identifier,
                Hospital.Number,
                Sex,
                Target.group,
                `Current.Weight.(kg)`,
                Pregnancy.Status,
                `Date.of.Birth.(yyyy-mm-dd)`,
                Care.Entry.Point,
                Date.of.Registration,
                `Enrollment.Date.(yyyy-mm-dd)`,
                `ART.Start.Date.(yyyy-mm-dd)`,
                `Last.Pickup.Date.(yyyy-mm-dd)`,
                Months.of.ARV.Refill,
                Regimen.Line.at.ART.Start,
                Regimen.at.ART.Start,
                Date.of.Start.of.Current.ART.Regimen,
                Current.Regimen.Line,
                Current.ART.Regimen,
                Clinical.Staging.at.Last.Visit,
                Date.of.Last.CD4.Count,
                Last.CD4.Count,
                `Date.of.Viral.Load.Sample.Collection.(yyyy-mm-dd)`,
                `Date.of.Current.ViralLoad.Result.Sample.(yyyy-mm-dd)`,
                `Current.Viral.Load.(c/ml)`,
                `Date.of.Current.Viral.Load.(yyyy-mm-dd)`,
                Viral.Load.Indication,
                Current.ART.Status,
                Date.of.Current.ART.Status,
                Client.Verification.Outcome,
                Cause.of.Death,
                VA.Cause.of.Death,
                Previous.ART.Status,
                Confirmed.Date.of.Previous.ART.Status,
                ART.Enrollment.Setting,
                `Date.of.TB.Screening.(yyyy-mm-dd)`,
                TB.Screening.Type,
                TB.status,
                `Date.of.TB.Sample.Collection.(yyyy-mm-dd)`,
                TB.Diagnostic.Test.Type,
                `Date.of.TB.Diagnostic.Result.Received.(yyyy-mm-dd)`,
                TB.Diagnostic.Result,
                `Date.of.Start.of.TB.Treatment.(yyyy-mm-dd)`,
                `TB.Type.(new,.relapsed.etc)`,
                `Date.of.Completion.of.TB.Treatment.(yyyy-mm-dd)`,
                TB.Treatment.Outcome,
                `Date.of.TPT.Start.(yyyy-mm-dd)`,
                TPT.Type,
                `TPT.Completion.date.(yyyy-mm-dd)`,
                TPT.Completion.status,
                `Date.of.commencement.of.EAC.(yyyy-mm-dd)`,
                Number.of.EAC.Sessions.Completed,
                Date.of.last.EAC.Session.Completed,
                `Date.of.Extended.EAC.Completion.(yyyy-mm-dd)`,
                `Date.of.Repeat.Viral.Load.-.Post.EAC.VL.Sample.collected.(yyyy-mm-dd)`,
                `Repeat.Viral.load.result.(c/ml)-.POST.EAC`,
                `Date.of.Repeat.Viral.load.result-.POST.EAC.VL`,
                Date.of.devolvement,
                Model.devolved.to,
                Date.of.current.DSD,
                Current.DSD.model,
                `Date.of.Return.of.DSD.Client.to.Facility.(yyyy-mm-dd)`,
                Screening.for.Chronic.Conditions,
                `Co-morbidities`,
                `Date.of.Cervical.Cancer.Screening.(yyyy-mm-dd)`,
                Cervical.Cancer.Screening.Type,
                Cervical.Cancer.Screening.Method,
                Result.of.Cervical.Cancer.Screening,
                `Date.of.Precancerous.Lesions.Treatment.(yyyy-mm-dd)`,
                Precancerous.Lesions.Treatment.Methods
                )

# MERGE BOTH FILES
RADET <- reduce(list(RADET.a, RADET.b), rbind)
